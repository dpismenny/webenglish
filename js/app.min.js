jQuery(function(a){"use strict";function b(a){return(a>9?"":"0")+a}function c(a,c){a=parseInt(a||0,10),a=c?Math.round(a/1e3):a;var d=Math.floor(a/3600),e=Math.floor(a%3600/60),f=a%60,g=(d?"{hours}:":"")+"{minutes}:{seconds}";return g.replace("{hours}",b(d)).replace("{minutes}",b(e)).replace("{seconds}",b(f))}var d=a(window);a.ajaxSetup({cache:!1,dataType:"json"}),function(b){b&&(d.one("sm2_init",function(){b.setup({url:"/js/soundmanager2/swf/",preferFlash:!1,onready:function(){d.trigger("sm2_ready")},ontimeout:function(){throw new Error("SoundManager2 init error")}})}),a.fn.jsplayer=function(d){return d=d||{},a(this).each(function(){var e=a(this),f=a(".js-player-time",e),g=a(".js-playpause",e),h=a(".js-bar",e),i=h.parent(),j=e.data("url")||d.url,k=(e.data("volume")||d.volume||100,!!e.data("autoplay")||d.autoplay),l=!!e.data("autoload")||d.autoload,m=g.data("pause")||d.classPause,n=g.data("play")||d.classPlay;if(e.data("jsplayer_added"))return!1;e.on("do_init",function(){o.position>0||(o.loaded?o.play():o.load(),g.off(".init"))}).on("do_stop",function(){o.stop()}).on("error",function(){e.addClass("is-hold")}).on("time",function(a,b){f.html("-"+c(b,!0))}).on("bar",function(){var a=100*(o.position/o.duration);a=a.toFixed(2),h.width(a+"%")}).on("play_state",function(){g.removeClass(n).addClass(m)}).on("pause_state",function(){g.removeClass(m).addClass(n)}).data("jsplayer_added",!0),i.click(function(a){if(o.loaded&&o.duration){var b=(a.offsetX||a.originalEvent.layerX||0)/i.width();b*=o.duration,o.setPosition(b),e.trigger("time",o.duration-o.position).trigger("bar")}});var o=b.createSound({url:j,autoLoad:l,autoPlay:k,onload:function(){return this.loaded?(e.trigger("time",this.duration),g.off().click(a.proxy(function(){this.paused||0===this.playState?this.play():this.pause()},this)),this.play(),void 0):e.trigger("error")},onplay:function(){e.trigger("play_state")},onresume:function(){e.trigger("play_state")},onpause:function(){e.trigger("pause_state")},onstop:function(){this.setPosition(0),e.trigger("pause_state").trigger("time",this.duration).trigger("bar")},onfinish:function(){e.trigger("finish").trigger("pause_state").trigger("time",this.duration).trigger("bar")},whileplaying:function(){e.trigger("time",this.duration-this.position).trigger("bar")},volume:100});g.one("click.init",function(){e.trigger("do_init")})})},d.one("sm2_ready",function(){a(".js-player").jsplayer({test:!0})}),a(".js-player").length&&d.trigger("sm2_init"))}(window.soundManager),function(){a.fn.auditWrap=function(){d.trigger("sm2_init");var b=a(this);return b.each(function(){var d=a(this),e=a(".js-player-empty",d),f=null,g=d.data(),h=g.active,i=g.form,j=g.cancel,k=!1;if(!i||!j||!h)throw new Error("Missing required data-attribites for audit element");d.on("timer_start",function(b,d){var e=null,g=a(".js-audit-time",f),h=function(){d--,g.text(c(d)),0>=d&&f.trigger("timerdone")};f.on("closeend timerdone",function(){clearInterval(e),e=null}),e=setInterval(h,1e3),h()}).on("init_form",function(){var c=a(":submit",f),g=a('[name="mvt_opinion[accepted]"]',f);f.off().on("timerdone",function(){d.removeClass(h),f.trigger("close")}).on("close",function(){f.slideUp(function(){f.trigger("closeend").off().remove()}),e.trigger("do_stop"),b.removeClass("is-hold")}).on("submit",function(b,c){return g.attr("checked","yes"===c.name),a.ajax(f.attr("action"),{type:f.attr("method"),data:f.serialize(),complete:function(){f.on("closeend",function(){d.off().remove()}).trigger("close")}}),!1}).appendTo(d).slideDown(function(){k=!1}),c.click(function(){var b=a(this);return b.hasClass("is-disabled")?!1:(f.trigger("submit",{name:b.attr("name")}),void 0)})}).on("req_form",function(){k=!0,a.ajax(i,{success:function(c){d.addClass(h),b.not("."+h).addClass("is-hold"),f=a(c.form),d.trigger("init_form").trigger("timer_start",c.time_left),c.file&&e.jsplayer({url:c.file}).on("finish",function(){f.find(":submit").removeClass("is-disabled")}).trigger("do_init")},error:function(){k=!1}})}).on("req_cancel",function(){k=!0,a.ajax(i,{success:function(){b.removeClass(h).removeClass("is-hold"),f.on("closeend",function(){k=!1}).trigger("close")},error:function(){k=!1}})}).on("click",function(b){if(k||d.hasClass("is-hold"))return!1;var c=a(b.target).closest(".js-button-cancel").length;return!c&&d.hasClass(h)?!1:(d.trigger(c?"req_cancel":"req_form"),!1)})})},a(".js-audit-row").auditWrap()}(),function(){a.fn.evaluationWrap=function(){var b=a(this),e=_.template(a("#tpl_evaluation_info").html()),f=_.template(a("#tpl_evaluation_player").html());return d.trigger("sm2_init"),b.each(function(){var d,g,h,i,j,k,l,m=a(this),n=0,o=-1,p=m.data(),q=!1;m.on("next",function(){return o++,l.dialogs[n]?l.dialogs[n].speeches[o]?(g.each(function(b){a(this).addClass(n>b?"is-done":n===b?"is-active":"")}),m.trigger("toggle_button",!1).trigger("init_speech"),void 0):(n++,o=-1,m.trigger("next")):m.trigger("remove")}).on("init_speech",function(){var b=l.dialogs[n].speeches[o],c=b.origin,d=b.translated;m.trigger("add_player",c),j.on("finish",function(){m.trigger("add_player",d),j.trigger("do_init").on("finish",function(){m.trigger("toggle_button",!0),h.off().one("click.ajax",function(){return h.off(".ajax"),a.ajax(p.post,{type:"POST",data:{state:a(this).data("value"),id:b.id},error:function(){},complete:function(){m.trigger("next")}}),!1}).click(function(){return!1})})})}).on("init_dialogs",function(){d=a(e(l)),k=a(".js-player-wrap",d),h=a(".js-evaluation-button",d),i=a(".js-evaluation-time",d),g=a(".js-steps li",d),d.insertAfter(m),m.trigger("next").trigger("open")}).on("init_timer",function(a,b){var d=null,e=function(){b--,i.text(c(b)),0>=b&&m.trigger("remove")};m.on("close remove",function(){clearInterval(d),d=null}),d=setInterval(e,1e3),e()}).on("add_player",function(b,c){j&&j.off().remove(),j=a(f({url:c})),j.appendTo(k).jsplayer().trigger("do_init")}).on("toggle_button",function(a,b){h.toggleClass("is-disabled",!b).click(function(){return!1})}).on("open",function(){m.addClass("is-active").trigger("init_timer",l.left_time),b.not(".is-active").addClass("is-hold"),j.trigger("do_init"),d.slideDown()}).on("close",function(){m.removeClass("is-active"),b.removeClass("is-hold"),j.trigger("do_stop"),d.slideUp()}).on("remove",function(){j.trigger("do_stop"),m.add(h).add(j).off(),d.slideUp(function(){d.remove(),m.remove(),b.removeClass("is-hold")})}).click(function(){return q||m.hasClass("is-hold")?!1:d?(m.trigger(d.is(":visible")?"close":"open"),!1):(q=!0,a.ajax(p.url,{success:function(a){l=a,m.trigger("init_dialogs")},complete:function(){q=!1},error:function(){}}),!1)})})},a(".js-evaluation").evaluationWrap()}(),a(".js-auth").click(function(){var b=a(this),c=a(".js-popups");return b.hasClass("is-open")?(b.removeClass("is-open"),c.fadeOut()):(c.fadeOut(),b.addClass("is-open").next().fadeIn()),!1}),a(".chzn-select").chosen({disable_search_threshold:100}),a(".js-accord-body").hide(),a(".js-accord-body1").show(),a(".js-accord").click(function(){var b=a(this);b.toggleClass("is-active").next()[b.hasClass("is-active")?"slideDown":"slideUp"]("fast")}),a(".account__list li").not(".account__more").click(function(){return a(this).toggleClass("is-selected"),!1})});