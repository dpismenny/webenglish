jQuery(function(a){"use strict";function b(a){return(a>9?"":"0")+a}function c(a,c){a=parseInt(a||0,10),a=c?Math.round(a/1e3):a;var d=Math.floor(a/3600),e=Math.floor(a%3600/60),f=a%60,g=(d?"{hours}:":"")+"{minutes}:{seconds}";return g.replace("{hours}",b(d)).replace("{minutes}",b(e)).replace("{seconds}",b(f))}var d=a(window);a.ajaxSetup({cache:!1,dataType:"json"}),function(){var b={popup:_.template(a("#tpl_notification_popup").html()),error:_.template(a("#tpl_notification_error").html())};d.on("create_notification",function(c,d){var e,f=a(b[d.type](d)),g=a(".js-close",f);f.on("close",function(){f.fadeOut(function(){f.off().remove()}),clearTimeout(e),e=null}).appendTo("body").fadeIn(),g.click(function(){return f.trigger("close"),!1}),d.timeout&&setTimeout(function(){f.trigger("close")},1e3*d.timeout)}).on("create_popup",function(b,c){c=a.extend({type:"popup",timeout:5,message:""},c||{}),d.trigger("create_notification",c)}).on("create_error",function(b,c){c=a.extend({type:"error",timeout:3,title:"Error",message:""},c||{}),d.trigger("create_notification",c)})}(),function(b){b&&(d.one("sm2_init",function(){b.setup({url:"/js/soundmanager2/swf/",preferFlash:!1,onready:function(){d.trigger("sm2_ready")},ontimeout:function(){throw new Error("SoundManager2 init error")}})}),a.fn.jsplayer=function(e){return e=e||{},a(this).each(function(){var f=a(this),g=a(".js-player-time",f),h=a(".js-playpause",f),i=a(".js-bar",f),j=a(".js-notch",f),k=i.parent(),l=f.data("url")||e.url,m=(f.data("volume")||e.volume||100,!!f.data("autoplay")||e.autoplay),n=!!f.data("autoload")||e.autoload,o=!!f.data("onlyback")||e.onlyback,p=h.data("pause")||e.classPause,q=h.data("play")||e.classPlay;if(f.data("jsplayer_added"))return!1;f.on("do_init",function(){r.position>0||(r.loaded?r.play():r.load(),h.off(".init"))}).on("do_stop",function(){r.stop(),j.hide()}).on("error",function(){f.addClass("is-hold"),d.trigger("create_popup",{message:"Audio file not found"})}).on("time",function(a,b){g.html("-"+c(b,!0))}).on("bar",function(){var a=100*(r.position/r.duration);a=a.toFixed(2),i.width(a+"%")}).on("notch",function(){var a=r.maxPosition/r.duration;1!==a&&(a*=100,a=a.toFixed(2),j.show().css("left",a+"%"),f.on("bar.notch",function(){r.position<r.maxPosition||(j.hide(),f.off(".notch"))}))}).on("play_state",function(){h.removeClass(q).addClass(p)}).on("pause_state",function(){h.removeClass(p).addClass(q)}).data("jsplayer_added",!0),k.click(function(b){if(!a(b.target).closest(".js-notch").length&&r.loaded&&r.duration){var c=(b.offsetX||b.originalEvent.layerX||0)/k.width();if(c*=r.duration,o){if(c>r.maxPosition)return;f.trigger("notch")}r.setPosition(c),f.trigger("time",r.duration-r.position).trigger("bar")}});var r=b.createSound({url:l,autoLoad:n,autoPlay:m,onload:function(){return this.loaded?(f.trigger("time",this.duration),h.off().click(a.proxy(function(){this.paused||0===this.playState?this.play():this.pause()},this)),this.play(),void 0):f.trigger("error")},onplay:function(){f.trigger("play_state")},onresume:function(){f.trigger("play_state")},onpause:function(){f.trigger("pause_state")},onstop:function(){this.setPosition(0),f.trigger("pause_state").trigger("time",this.duration).trigger("bar")},onfinish:function(){f.trigger("finish").trigger("pause_state").trigger("time",this.duration).trigger("bar")},whileplaying:function(){this.maxPosition=Math.max(this.maxPosition||0,this.position),f.trigger("time",this.duration-this.position).trigger("bar")},volume:100});h.one("click.init",function(){f.trigger("do_init")})})},d.one("sm2_ready",function(){a(".js-player").jsplayer({test:!0})}),a(".js-player").length&&d.trigger("sm2_init"))}(window.soundManager),function(){a.fn.auditWrap=function(){d.trigger("sm2_init");var b=a(this);return b.each(function(){var e=a(this),f=a(".js-player-empty",e),g=null,h=e.data(),i=h.active,j=h.form,k=h.cancel,l=!1;if(!j||!k||!i)throw new Error("Missing required data-attribites for audit element");e.on("timer_start",function(b,d){var e=null,f=a(".js-audit-time",g),h=function(){d--,f.text(c(d)),0>=d&&g.trigger("timerdone")};g.on("closeend timerdone",function(){clearInterval(e),e=null}),e=setInterval(h,1e3),h()}).on("init_form",function(){var c=a(":submit",g),h=a('[name="mvt_opinion[accepted]"]',g);g.off().on("timerdone",function(){e.removeClass(i),g.trigger("close"),d.trigger("create_popup",{message:"Audit timeout"})}).on("close",function(){g.slideUp(function(){g.trigger("closeend").off().remove()}),f.trigger("do_stop"),b.removeClass("is-hold")}).on("submit",function(b,c){return h.attr("checked","yes"===c.name),a.ajax(g.attr("action"),{type:g.attr("method"),data:g.serialize(),complete:function(){g.on("closeend",function(){e.off().remove()}).trigger("close")},error:function(){}}),!1}).appendTo(e).slideDown(function(){l=!1}),c.click(function(){var b=a(this);return b.hasClass("is-disabled")?!1:(g.trigger("submit",{name:b.attr("name")}),void 0)})}).on("req_form",function(){l=!0,a.ajax(j,{success:function(c){e.addClass(i),b.not("."+i).addClass("is-hold"),g=a(c.form),e.trigger("init_form").trigger("timer_start",c.time_left),c.file&&f.jsplayer({url:c.file}).on("finish",function(){g.find(":submit").removeClass("is-disabled")}).trigger("do_init")},error:function(){l=!1}})}).on("req_cancel",function(){l=!0,a.ajax(j,{success:function(){b.removeClass(i).removeClass("is-hold"),g.on("closeend",function(){l=!1}).trigger("close")},error:function(){l=!1}})}).on("click",function(b){if(l||e.hasClass("is-hold"))return!1;var c=a(b.target).closest(".js-button-cancel").length;return!c&&e.hasClass(i)?!1:(e.trigger(c?"req_cancel":"req_form"),!1)})})},a(".js-audit-row").auditWrap()}(),function(){a.fn.evaluationWrap=function(){var b=a(this),e=_.template(a("#tpl_evaluation_info").html()),f=_.template(a("#tpl_evaluation_player").html());return d.trigger("sm2_init"),b.each(function(){var g,h,i,j,k,l,m,n=a(this),o=0,p=-1,q=n.data(),r=!1;n.on("next",function(){return p++,m.dialogs[o]?m.dialogs[o].speeches[p]?(h.each(function(b){a(this).addClass(o>b?"is-done":o===b?"is-active":"")}),n.trigger("toggle_button",!1).trigger("init_speech"),void 0):(o++,p=-1,n.trigger("next")):n.trigger("remove")}).on("init_speech",function(){var b=m.dialogs[o].speeches[p],c=b.origin,d=b.translated;n.trigger("add_player",c),k.on("finish",function(){n.trigger("add_player",d),k.trigger("do_init").on("finish",function(){n.trigger("toggle_button",!0),i.off().one("click.ajax",function(){return i.off(".ajax"),a.ajax(q.post,{type:"POST",data:{state:a(this).data("value"),id:b.id},error:function(){},complete:function(){n.trigger("next")}}),!1}).click(function(){return!1})})})}).on("init_dialogs",function(){g=a(e(m)),l=a(".js-player-wrap",g),i=a(".js-evaluation-button",g),j=a(".js-evaluation-time",g),h=a(".js-steps li",g),g.insertAfter(n),n.trigger("next").trigger("open")}).on("init_timer",function(a,b){var e=null,f=function(){b--,j.text(c(b)),0>=b&&(n.trigger("remove"),d.trigger("create_popup",{message:"Evaluation timeout"}))};n.on("close remove",function(){clearInterval(e),e=null}),e=setInterval(f,1e3),f()}).on("add_player",function(b,c){k&&k.off().remove(),k=a(f({url:c})),k.appendTo(l).jsplayer().trigger("do_init")}).on("toggle_button",function(a,b){i.toggleClass("is-disabled",!b).click(function(){return!1})}).on("open",function(){n.addClass("is-active").trigger("init_timer",m.left_time),b.not(".is-active").addClass("is-hold"),k.trigger("do_init"),g.slideDown()}).on("close",function(){n.removeClass("is-active"),b.removeClass("is-hold"),k.trigger("do_stop"),g.slideUp()}).on("remove",function(){k.trigger("do_stop"),n.add(i).add(k).off(),g.slideUp(function(){g.remove(),n.remove(),b.removeClass("is-hold")})}).click(function(){return r||n.hasClass("is-hold")?!1:g?(n.trigger(g.is(":visible")?"close":"open"),!1):(r=!0,a.ajax(q.url,{success:function(a){m=a,n.trigger("init_dialogs")},complete:function(){r=!1},error:function(){}}),!1)})})},a(".js-evaluation").evaluationWrap()}(),a(".js-auth").click(function(){var b=a(this),c=a(".js-popups");return b.hasClass("is-open")?(b.removeClass("is-open"),c.fadeOut()):(c.fadeOut(),b.addClass("is-open").next().fadeIn()),!1}),a(".chzn-select").chosen({disable_search_threshold:100}),a(".js-accord-body").hide(),a(".js-accord-body1").show(),a(".js-accord").click(function(){var b=a(this);b.toggleClass("is-active").next()[b.hasClass("is-active")?"slideDown":"slideUp"]("fast")}),a(".account__list li").not(".account__more").click(function(){return a(this).toggleClass("is-selected"),!1})});