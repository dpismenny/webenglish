jQuery(function(a){"use strict";function b(a){return(a>9?"":"0")+a}function c(a,c){a=parseInt(a||0,10),a=c?Math.round(a/1e3):a;var d=Math.floor(a/3600),e=Math.floor(a%3600/60),f=a%60,g=(d?"{hours}:":"")+"{minutes}:{seconds}";return g.replace("{hours}",b(d)).replace("{minutes}",b(e)).replace("{seconds}",b(f))}var d=a(window);a.ajaxSetup({cache:!1,dataType:"json"}),function(b){b&&(d.on("sm2init",function(){b.setup({url:"/js/soundmanager2/swf/",preferFlash:!1,onready:function(){d.trigger("sm2ready")},ontimeout:function(){}})}),a.fn.jsplayer=function(){return a(this).each(function(){var d=a(this),e=a(".js-player-time",d),f=a(".js-playpause",d),g=a(".js-bar",d),h=g.parent(),i=!!d.data("autoplay"),j=f.data("pause"),k=f.data("play"),l=d.data("url");d.on("init",function(){f.off(".init"),m.position>0||(m.loaded?m.play():m.load())}).on("error",function(){d.addClass("is-hold")}).on("time",function(a,b){e.html("-"+c(b,!0))}).on("bar",function(){var a=100*(m.position/m.duration);a=a.toFixed(2),g.width(a+"%")}).on("play_state",function(){f.removeClass(k).addClass(j)}).on("pause_state",function(){f.removeClass(j).addClass(k)}),h.click(function(a){if(m.loaded&&m.duration){var b=(a.offsetX||a.originalEvent.layerX||0)/h.width();b*=m.duration,m.setPosition(b),d.trigger("time",m.duration-m.position).trigger("bar")}});var m=b.createSound({url:l,autoLoad:!1,autoPlay:i,onload:function(){return this.loaded?(d.trigger("time",this.duration),f.click(a.proxy(function(){this.paused||0===this.playState?this.play():this.pause()},this)),this.play(),void 0):d.trigger("error")},onplay:function(){d.trigger("play_state")},onresume:function(){d.trigger("play_state")},onpause:function(){d.trigger("pause_state")},onstop:function(){this.setPosition(0),d.trigger("pause_state").trigger("time",this.duration).trigger("bar")},onfinish:function(){d.trigger("finish").trigger("pause_state").trigger("time",this.duration).trigger("bar")},whileplaying:function(){d.trigger("time",this.duration-this.position).trigger("bar")},volume:100});f.one("click.init",function(){d.trigger("init")}),d.data("sound",m)})},d.on("sm2ready",function(){a(".js-player").jsplayer({test:!0})}),a(".js-player").length&&d.trigger("sm2init"))}(window.soundManager),function(){function b(b,d){var e=null,f=a(".js-audit-time",b),g=function(){d--,f.text(c(d)),0>=d&&b.trigger("timerdone")};b.on("closeend timerdone",function(){clearInterval(e),e=null}),e=setInterval(g,1e3),g()}var e=a(".js-audit-row");e.each(function(){function c(b,c){return c=c||{},c.name?(a('[name="mvt_opinion[accepted]"]',g).attr("checked","yes"==c.name),a.ajax(g.attr("action"),{type:g.attr("method"),data:g.serialize(),complete:function(){g.on("closeend",function(){d.off().remove()}).trigger("close")}}),!1):!1}var d=a(this),f=a(".js-player-empty",d),g=null,h=d.data(),i=!1;d.on("click",function(j){if(i||d.hasClass("is-hold"))return!1;var k,l,m=(a(this),a(j.target).closest(".js-button-cancel").length);if(!m&&d.hasClass(h.active))return!1;if(h.form&&!m)k=!0,l=h.form;else{if(!h.cancel||!m)return!1;k=!1,l=h.cancel}return i=!0,a.ajax(l,{success:function(j){h.active&&(d.toggleClass(h.active,k),e.not("."+h.active).toggleClass("is-hold",k)),j.form?(g=a(j.form),g.on("timerdone",function(){d.removeClass(h.active),g.trigger("close")}).on("close",function(){g.slideUp(function(){g.trigger("closeend").off().remove()}),f.data("sound").stop(),e.removeClass("is-hold")}).submit(c).appendTo(d).slideDown(function(){i=!1}).find(":submit").click(function(){var b=a(this);return b.hasClass("is-disabled")?!1:(g.trigger("submit",{name:b.attr("name")}),void 0)}),j.time_left&&b(g,j.time_left),!f.data("url")&&j.file&&f.data("url",j.file).jsplayer().on("finish",function(){g.find(":submit").removeClass("is-disabled")}),f.trigger("init")):g&&g.length?g.on("closeend",function(){i=!1}).trigger("close"):i=!1},error:function(){i=!1}}),!1})}),d.trigger("sm2init")}(),function(){if(a(".js-evaluation").length){var b=_.template(a("#tpl_evaluation_info").html()),c=_.template(a("#tpl_evaluation_player").html()),e=a(".js-evaluation");e.each(function(){function d(c){k=c,f=a(b({dialogs:k})),j=a(".js-player-wrap",f),h=a(".js-evaluation-button",f),g=a(".js-steps li",f),f.insertAfter(l).slideDown(),l.addClass("is-active").trigger("next"),e.not(".is-active").addClass("is-hold")}var f,g,h,i,j,k,l=a(this),m=0,n=-1,o=l.data(),p=!1;l.on("toggle_button",function(a,b){h.toggleClass("is-disabled",!b).click(function(){return!1})}).on("next",function(){return n++,k[m]?k[m].speeches[n]?(g.each(function(b){a(this).addClass(m>b?"is-done":m===b?"is-active":"")}),l.trigger("toggle_button",!1).trigger("init_speech"),void 0):(m++,n=-1,l.trigger("next")):(l.add(h).add(i).off(),f.slideUp(function(){f.remove(),l.remove()}),e.removeClass("is-hold"),void 0)}).on("init_speech",function(){var b=k[m].speeches[n],c=b.origin,d=b.translated;l.trigger("add_player",c),i.on("finish",function(){l.trigger("add_player",d),i.trigger("init").on("finish",function(){l.trigger("toggle_button",!0),h.off().one("click.ajax",function(){return h.off(".ajax"),a.ajax(o.post,{type:"POST",data:{state:a(this).data("value"),id:b.id},error:function(){},complete:function(){l.trigger("next")}}),!1}).click(function(){return!1})})})}).on("add_player",function(b,d){i&&i.off().remove(),i=a(c({url:d})),i.appendTo(j).jsplayer().trigger("init")}).click(function(){if(!p&&!l.hasClass("is-hold")){if(f){var b=!f.is(":visible");return l.toggleClass("is-active",b),e.not(".is-active").toggleClass("is-hold",b),b?i.trigger("init"):i.data("sound").stop(),f.slideToggle()}p=!0,a.ajax(o.url,{success:d,complete:function(){p=!1},error:function(){}})}})}),d.trigger("sm2init")}}(),a(".js-auth").click(function(){var b=a(this),c=a(".js-popups");return b.hasClass("is-open")?(b.removeClass("is-open"),c.fadeOut()):(c.fadeOut(),b.addClass("is-open").next().fadeIn()),!1}),a(".chzn-select").chosen({disable_search_threshold:100}),a(".js-accord-body").hide(),a(".js-accord-body1").show(),a(".js-accord").click(function(){var b=a(this);b.toggleClass("is-active").next()[b.hasClass("is-active")?"slideDown":"slideUp"]("fast")}),a(".account__list li").not(".account__more").click(function(){return a(this).toggleClass("is-selected"),!1})});